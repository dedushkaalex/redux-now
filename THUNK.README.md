### Ð’ÐµÑ‰ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð½ÑƒÐ¶Ð½Ð¾ Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð² Ð³Ð¾Ð»Ð¾Ð²Ðµ - Redux ÑÐ¾Ð·Ð´Ð°Ð½ Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°ÑˆÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð²Ð¸ÑÐµÐ»Ð¾ Ð¾Ñ‚ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð¸ Ð¾Ñ‚ Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð° ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð². (Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð¶Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð° Ð¿Ñ€Ð¸Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÑÑ„Ñ„ÐµÐºÑ‚Ð¾Ñ€)

### ÐšÐ°Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½ÑƒÑŽ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð² ÑÐ²ÑÐ·ÐºÐµ Ñ redux.

Ð”Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ð¼ ÑÐ°Ð¼Ñ‹Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±, Ð³Ð´Ðµ Ð¶Ðµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð²Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ? - ÐžÑ‚Ð²ÐµÑ‚ - _Ð’ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ðµ_.
ÐŸÐ¾ÑÐ»Ðµ Ñ‡ÐµÐ³Ð¾ Ð´ÐµÐ»Ð°ÐµÐ¼ dispatch, ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ñ Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ Ð½Ð°Ð¼ Ñ€ÐµÐ´ÑŽÑÐµÑ€.

**ÐŸÑÐµÐ²Ð´Ð¾ÐºÐ¾Ð´**

```js

//reducers
 fetchUsersPending: (state) => {
      state.fetchUsersStatus = "pending";
    },
    fetchUsersFailed: (state) => {
      state.fetchUsersStatus = "failed";
    },
    fetchUsersSuccess: (state, action: PayloadAction<{ users: User[] }>) => {
      const { users } = action.payload;

      state.fetchUsersStatus = "success";
      state.entities = users.reduce((acc, user) => {
        acc[user.id] = user;
        return acc;
      }, {} as Record<UserId, User>);

      state.ids = users.map((user) => user.id);
    },

 // Component
  const dispatch = useAppDispatch();
  const isPending = useAppSelector(usersSlice.selectors.selectIsFetchUserPending);
  const isIdle = useAppSelector(usersSlice.selectors.selectIsFetchUserIdle);

  useEffect(() => {
    if (!isIdle) return;

    dispatch(usersSlice.actions.fetchUsersPending());
    api
      .getUsers()
      .then((users) => {
        dispatch(usersSlice.actions.fetchUsersSuccess({ users }));
      })
      .catch(() => {
        dispatch(usersSlice.actions.fetchUsersFailed());
      });
  }, [dispatch, isIdle]);
```

Ð¢ÑƒÑ‚ ÐµÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° - Ð° Ð¸Ð¼ÐµÐ½Ð½Ð¾ ÐµÑÐ»Ð¸ Ñƒ Ð½Ð°Ñ StrictMode - Ñƒ Ð½Ð°Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ€Ð°Ð· Ð¾Ñ‚Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ useEffect Ð¸ Ñ€ÐµÑ„ÐµÑ‚Ñ‡Ð¸Ð½Ð³, Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ð¼Ñ‹ Ð·Ð°Ð²ÑÐ·Ð°Ð»Ð¸ÑÑŒ Ð½Ð° ÑÑ„Ñ„ÐµÐºÑ‚Ðµ Ð¸ ÑÑ‚Ð¾ Ð½Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾, Ð´Ð¾Ð±Ð°Ð²Ð¸Ð¼ Ñ„Ð»Ð°Ð³ isIdle Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ, Ð½Ð¾ ÑÑ‚Ð¾ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, - ÑÑ‚Ð¾ ÑÐ²ÑÐ·Ð°Ð½Ð¾ Ñ Ñ‚ÐµÐ¼, ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€Ñ‹, ÑÑ„Ñ„ÐµÐºÑ‚ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ð¾ÑÐ»Ðµ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³Ð° ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð° Ð¸ ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€Ñ‹ Ð£Ð–Ð• Ð¾Ñ‚Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸ Ð¸ + ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° idle, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ true Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¸ Ð¿Ð¾Ñ‚Ð¾Ð¼ ÐºÐ¾Ð³Ð´Ð° useEffect Ð¿ÐµÑ€ÐµÐ²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ idle Ð²ÑÐµ Ñ€Ð°Ð²Ð½Ð¾ true, Ñ…Ð¾Ñ‚Ñ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ‚Ð¾Ñ€Ð° Ð¾Ð½ false

ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ñ‚Ð°Ðº - Ñ‚Ð°Ðº Ð¿Ð¸ÑÐ°Ð»Ð¸ Ñ€Ð°Ð½ÑŒÑˆÐµ.
Ð¡Ð´ÐµÐ»Ð°Ð»Ð¸ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ð² ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ðµ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ Ð¿ÐµÑ€ÐµÐ´Ð°ÐµÑ‚ÑÑ Ð² Ñ€ÐµÐ´Ð°ÐºÑ.
Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¸ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ‚Ð°Ñ€Ñ‹Ð¹. Ð’Ñ€Ð¾Ð´Ðµ Ð±Ñ‹ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ ÐµÑ‰Ðµ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ async Thunk Ð¸ Ð¼Ð¸Ð´Ð»Ð²Ð°Ñ€ÐµÐ¹ (Ð½Ð°Ð´Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ) Ð¸ Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð»Ð¸ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼, ÐºÐ°Ðº Ð² Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ Ð½Ð¸Ð¶Ðµ

```js
const appStore = useAppStore();

useEffect(() => {
  const isIdle = usersSlice.selectors.selectIsFetchUserIdle(
    appStore.getState()
  );
  if (!isIdle) return;

  dispatch(usersSlice.actions.fetchUsersPending());
  api
    .getUsers()
    .then((users) => {
      dispatch(usersSlice.actions.fetchUsersSuccess({ users }));
    })
    .catch(() => {
      dispatch(usersSlice.actions.fetchUsersFailed());
    });
}, [dispatch, appStore]);
```

Ð’Ñ‹Ð½ÐµÑÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ð¤ÐµÑ‚Ñ‡Ð¸Ð½Ð³Ð°
_ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ñ„ÐµÑ‚Ñ‡Ð¸Ð½Ð³Ð°_ - Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³Ñƒ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð°.

```js
// Ð»ÑƒÑ‡ÑˆÐµ Ð±Ñ€Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ñ€, Ð´Ð¸ÑÐ¿Ð°Ñ‚Ñ‡ Ð¸ Ñ‚ Ð´ Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° - Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ñ€Ð°Ð½Ñ‚Ð°Ð¹Ð¼Ðµ Ð¸ Ñ‚ Ð´, ÐµÑÐ»Ð¸ Ð±ÐµÑ€ÐµÐ¼ ÑÑ‚Ð¾Ñ€ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ, Ñ‚Ð¾ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹.
export const fetchUsers = (dispatch: AppDispatch, getState: () => AppState) => {
  const isIdle = usersSlice.selectors.selectIsFetchUserIdle(getState());
  if (!isIdle) return;

  dispatch(usersSlice.actions.fetchUsersPending());
  api
    .getUsers()
    .then((users) => {
      dispatch(usersSlice.actions.fetchUsersSuccess({ users }));
    })
    .catch(() => {
      dispatch(usersSlice.actions.fetchUsersFailed());
    });
};

// Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ„ÐµÑ‚Ñ‡Ð¸Ð½Ð³
fetchUsers(store.dispatch, store.getState);

createRoot(document.getElementById("root")!).render(
  <Provider store={store}>
    <App />
  </Provider>
);
```

â€¼ï¸â€¼ï¸ **ÐÐ¾ Ð² Ñ‡ÐµÐ¼ Ð·Ð´ÐµÑÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° ?** - Ð½Ð°Ð¼ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð´Ð»Ñ Ð²Ñ‹Ð·Ð¾Ð²Ð° Ñ‚Ð°ÐºÐ¸Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð²ÑÐµÐ³Ð´Ð° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ useAppStore() Ñ‡ÐµÑ€ÐµÐ· Ñ…ÑƒÐºÐ¸, Ð¿Ñ€Ð¾ÐºÐ¸Ð´Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð· Ð½ÐµÐµ dispatch Ð¸ getState Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ñ„ÐµÑ‚Ñ‡Ð¸Ð½Ð³Ð°, Ð° ÐµÑ‰Ðµ ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð±Ð°Ð²Ð¸Ñ‚ÑÑ Ñ€Ð¾ÑƒÑ‚ÐµÑ€, Ð²ÑÑÐºÐ¸Ðµ Ñ…ÑƒÐºÐ¸ Ð´Ð»Ñ Ð½Ð¾Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¹, ÐºÐ°ÐºÐ¸Ðµ-Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¸ Ð¿Ñ€Ð¾Ñ‡ÐµÐµ - ÑÑ‚Ð¾ Ð¾Ð±ÑŠÐµÐ¼Ð½Ð¾ Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ - Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¸ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ð»Ð¸ _**Thunk**_. ÐÐ¾ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð½ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Thunk - Ñ€Ð°Ð·Ð±ÐµÑ€ÐµÐ¼ÑÑ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ñ middleware.

## Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ middleware?

1. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ð¼ÑÑ, Ñ‡Ñ‚Ð¾ ÑÐ°Ð¼ store (Ñ‚Ð¾Ñ‚ ÑÐ°Ð¼Ñ‹Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· configureStore) Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¼Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸ Ð¸Ð·Ð²Ð½Ðµ Ð¸ Ñ€ÐµÐ´Ð°ÐºÑ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð½Ð°Ð¼ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹, Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑÑ‚Ñƒ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¸Ð·Ð²Ð½Ðµ, Ð¿Ñ€Ð¸ ÑÑ‚Ð¾Ð¼ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼ - Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ middleware.

Ð£ Ð½Ð°Ñ Ð±Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð»Ð¾Ñ‚Ð½Ð¾ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ Ñ€ÐµÐ´Ð°ÐºÑÐ¾Ð¼ Ð»Ð¾Ð³Ð¸ÐºÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð»ÐµÐ³ÐºÐ¾ Ð´Ð¸ÑÐ¿Ð°Ñ‚Ñ‡Ð¸Ñ‚ÑŒ ÑÐºÑˆÐµÐ½Ñ‹, Ð»ÐµÐ³ÐºÐ¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ, Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð¸ Ñ‚ Ð´. ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÐºÐ¸Ð´Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ñ€ Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, ÐºÐ°Ðº Ð´ÐµÐ»Ð°Ð»Ð¸ Ð² Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ Ð²Ñ‹ÑˆÐµ, Ð½Ð¾ ÑÑ‚Ð¾ Ð½ÐµÑƒÐ´Ð¾Ð±Ð½Ð¾, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ñ€ÐµÐ´Ð°ÐºÑ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð¿Ð¾Ð´Ð¾Ð±Ð½Ð¾Ð¹ Ð»Ð¾Ð³Ð¸ÐºÐµ Ð² Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð¾Ð¼ Ð´Ð»Ñ ÑÑ‚Ð¾Ð¼ Ð¼ÐµÑÑ‚Ðµ - middleware (Ð¾Ð±Ñ‰ÐµÑ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½,)

Redux Middleware ÑÐ»ÑƒÐ¶Ð¸Ñ‚ Ð¼Ð¾ÑÑ‚Ð¾Ð¼ Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (action) Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡ÐµÐ¹ ÐµÐ³Ð¾ Ð² reducer. ÐšÐ°Ð¶Ð´Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ðµ Ñ€ÐµÐ´ÑƒÐºÑ‚Ð¾Ñ€Ñƒ, Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‡ÐµÐ½Ð¾ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Redux Middleware, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð¸Ð·Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð¸Ð»Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ.
![alt text](images/image-10.png)

Ð’ ÑÐ°Ð¼Ð¾Ð¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ðµ middleware ÑÑ‚Ð¾ 3 Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÑŽÑ‚ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ð°

```js
// Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¼Ð¸Ð´Ð»Ð²Ð°Ñ€ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ ÑÑ‚Ð¾Ñ€
// ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ store â€” Ð½ÑƒÐ¶Ð½Ð¾ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº getState(), Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
function logger(store) {
  //Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ð´Ð¸ÑÐ¿Ð°Ñ‚Ñ‡ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹
  // ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ next (ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ middleware Ð¸Ð»Ð¸ dispatch) â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð´Ð°Ð»ÑŒÑˆÐµ Ð¿Ð¾ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐµ.
  return function wrapDispatchToAddLogging(next) {
    //ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ action â€” ÑÐ°Ð¼Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ð¸ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼.
    return function dispatchAndLog(action) {
      console.log("dispatching", action);
      const result = next(action); // ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° action Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ middleware Ð¸Ð»Ð¸ reducer
      console.log("next state", store.getState());
      return result; // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð´Ð°Ð»ÑŒÑˆÐµ Ð¿Ð¾ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐµ
    };
  };
}
```

## Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Thunk?

**Thunk** - ÑÑ‚Ð¾ Ð¼Ð¸Ð´Ð»Ð²Ð°Ñ€ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¾ ÑÑƒÑ‚Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ñ‚Ðµ Ð²ÐµÑ‰Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ñ‹ Ñ€Ð°ÑÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ð¸ Ð²Ñ‹ÑˆÐµ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ _fetchUsers(store.dispatch, store.getState);_. Ð¢Ð¾ ÐµÑÑ‚ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ°ÐºÐ¸Ðµ-Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (Ð´Ð¸ÑÐ¿Ð°Ñ‚Ñ‡Ð¸Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸\*), Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚Ðµ Ñƒ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… ÐµÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº **getState** Ð¸ **dispatch**.

_ÐšÐ°ÐºÑƒÑŽ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ Ñ€ÐµÑˆÐ°ÐµÑ‚?_ - Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÑ‚ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ dispatch Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ‚ÑŒ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ _Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹_({action: 'ADD_USER', payload: {id: 1, name: 'Alex'}}), Ð½Ð¾ Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸.

ðŸŽ¯ ÐšÐ°ÐºÐ¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ñ€ÐµÑˆÐ°ÐµÑ‚ Redux Thunk?

- [x]1ï¸âƒ£ ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
- [x]2ï¸âƒ£ ÐžÑ‚Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ (deferred) Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ dispatch, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ setTimeout)
- [x]3ï¸âƒ£ Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº getState()
- [x]4ï¸âƒ£ ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° extraArguments (API, ÑÐµÑ€Ð²Ð¸ÑÑ‹, ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð¸) (ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° API Ð² ÐºÐ°Ð¶Ð´ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ ÐµÐ³Ð¾ Ð² middleware)

Ð’Ð¾Ñ‚ Ð¿Ð¾ ÑÑƒÑ‚Ð¸ ÐºÐ°Ðº ÑƒÑÑ‚Ñ€Ð¾ÐµÐ½ thunk-middleware:

```js
function thunk(store) {
  return function wrapDispatch(next) {
    return function handleAction(action) {
      if (typeof action === 'function') {
        return action(store.dispatch, store.getState);
      }
      return next(action);
    };

 //Ð½Ð° ÑÑ‚Ñ€ÐµÐ»ÐºÐ°Ñ…
 const thunkMiddleware = ({dispatch, getState}) =>
 next =>
 action => {
  if (typeof action === "function") {
    return action(dispatch, getState)
  }
  return next(action)
 }

 // Ð¸Ð»Ð¸ Ñ extraArguments - Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
 function createThunkMiddleware(extraArgument) {
  return function thunk(store) {
    return function wrapDispatch(next) {
      return function handleAction(action) {
        if (typeof action === 'function') {
          return action(store.dispatch, store.getState, extraArgument);
        }
        return next(action);
      };
    };
  };
}
```

ðŸŸ¢Ð’Ð°Ð¶Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ - ÐµÑÐ»Ð¸ Ð½Ð°Ð¼ Ð½Ð°Ð´Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð² thunk, Ð½Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ thunk. - ÑÐºÑˆÐ½ ÐºÑ€Ð¸ÐµÐ¹Ñ‚Ð¾Ñ€

```js
export const fetchUser =
  (userId: string) => (dispatch: AppDispatch, getState: () => AppState) => {};
const dispatch = useAppDispatch();

dispatch(fetchUser("12345"));
```
